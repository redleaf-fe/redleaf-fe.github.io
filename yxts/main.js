!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var n=["不堪一击","毫不足虑","不足挂齿","初学乍练","勉勉强强","初窥门径","初出茅庐","普普通通","平淡无奇","登堂入室","已有小成","驾轻就熟","融会贯通","心领神会","炉火纯青","已有大成","青出於蓝","出类拔萃","鹤立鸡群","非比寻常","罕有敌手","傲视群雄","登峰造极","出神入化","无与伦比","所向披靡","一代宗师","深不可测","举世无双","惊世骇俗","撼天动地","震古铄今","超凡入圣","空前绝后","威镇寰宇","天人合一","返璞归真"];function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.back=new Image,this.forward=new Image,this.left=new Image,this.left2=new Image,this.right=new Image,this.right2=new Image,this.back.src=imageMap["./images/player/back.png"],this.forward.src=imageMap["./images/player/forward.png"],this.left.src=imageMap["./images/player/left.png"],this.left2.src=imageMap["./images/player/left2.png"],this.right.src=imageMap["./images/player/right.png"],this.right2.src=imageMap["./images/player/right2.png"],this.w=32*pixelRatio,this.h=32*pixelRatio,this.x=t,this.y=i,this.dir="right",this.img=this.right,this.visible=!0;var n=getSaveData(),a=n.lv,s=void 0===a?1:a,o=n.exp,r=void 0===o?100:o,l=n.gold,h=void 0===l?500:l,c=n.food,u=void 0===c?300:c,p=n.water,m=void 0===p?300:p,f=n.items,d=void 0===f?[]:f;this.food=u,this.maxfood=300,this.water=m,this.maxwater=300,this.lv=s,this.exp=r,this.hp=50*this.lv,this.maxhp=50*this.lv,this.attack=10*this.lv,this.gold=h,this.items=d}var t,i,a;return t=e,(i=[{key:"foodwater",value:function(){this.food-=2,this.food=Math.max(0,this.food),this.water-=2,this.water=Math.max(0,this.water),this.save()}},{key:"turn",value:function(e){this.dir===e&&["left","right"].includes(e)&&this.lastImg===this[e]?this.img=this["".concat(e,"2")]:this.img=this[e],this.dir=e}},{key:"drawToCanvas",value:function(e){this.visible&&(e.drawImage(this.img,this.x-this.w/2,this.y-this.h/2,this.w,this.h),this.lastImg=this.img)}},{key:"getStatesText",value:function(){return["等级: ".concat(this.lv),"武艺: ".concat(n[Math.min(36,Math.floor(this.lv/5))]),"金钱: ".concat(this.gold),"水量: ".concat(this.water,"/").concat(this.maxwater),"食物量: ".concat(this.food,"/").concat(this.maxfood),"HP: ".concat(this.hp,"/").concat(this.maxhp),"下一次升级所需经验: ".concat(this.exp)]}},{key:"getReward",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=[];if(t.gold&&(i.push("获得".concat(t.gold,"金钱")),this.gold+=t.gold),t.exp)for(i.push("获得".concat(t.exp,"经验")),this.exp-=t.exp;this.exp<=0;)this.lv+=1,this.exp=100*this.lv+this.exp,this.maxhp+=50,this.hp=this.maxhp,this.attack+=10,i.push("你的等级提升了");t.items&&t.items.forEach((function(t){i.push("获得".concat(t.n,"x").concat(t.c));var n=e.items.find((function(e){return e.n===t.n}));n?n.c+=t.c:e.items.push({n:t.n,c:t.c})})),this.save(),i.length&&main.autohideText.setContent(i)}},{key:"die",value:function(){this.lv-=1,this.lv=Math.max(1,this.lv),this.hp=50*this.lv,this.maxhp=50*this.lv,this.attack=10*this.lv,this.food=300,this.water=300,this.save()}},{key:"save",value:function(){var e=this.lv,t=void 0===e?1:e,i=this.exp,n=void 0===i?100:i,a=this.gold,o=void 0===a?500:a,r=this.food,l=void 0===r?300:r,h=this.water,c=void 0===h?300:h,u=this.items,p=void 0===u?[]:u,m=getSaveData();setSaveData(s(s({},m),{},{lv:t,exp:n,gold:o,food:l,water:c,items:p}))}}])&&r(t.prototype,i),a&&r(t,a),e}();function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),e}function p(e,t,i){var n=5*pixelRatio,a=e.x,s=e.y,o=e.w,r=e.h,l=!!(t>=a-o/2-n&&i>=s-r/2-n&&t<=a+o/2+n&&i<=s+r/2+n);return l&&(e.hasShadow=!1),l}var m=function(){function e(t,i,n){h(this,e),this.img=new Image,this.img.src=imageMap["./images/other/".concat(t,".png")],this.x=i,this.y=n,this.w=32*pixelRatio,this.h=32*pixelRatio,this.hasShadow=!0}return u(e,[{key:"drawToCanvas",value:function(e){e.save(),this.hasShadow?(e.shadowColor="rgba(0,0,0,.5)",e.shadowOffsetX=3*pixelRatio,e.shadowOffsetY=3*pixelRatio,e.shadowBlur=3*pixelRatio):this.hasShadow=!0,e.drawImage(this.img,this.x-this.w/2,this.y-this.h/2,this.w,this.h),e.restore()}},{key:"checkIsFingerOn",value:function(e,t){return p(this,e,t)}}]),e}(),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];h(this,e),this.text=t,this.x=i,this.y=n,this.border=a,this.w=48*pixelRatio,this.h=28*pixelRatio,this.hasShadow=!0}return u(e,[{key:"drawToCanvas",value:function(e){this.border&&(e.save(),this.hasShadow?(e.shadowColor="rgba(0,0,0,.5)",e.shadowOffsetX=3*pixelRatio,e.shadowOffsetY=3*pixelRatio,e.shadowBlur=3*pixelRatio):this.hasShadow=!0,e.strokeRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h),e.restore()),e.fillText(this.text,this.x-this.w/2+4*pixelRatio,this.y-this.h/2+4*pixelRatio)}},{key:"checkIsFingerOn",value:function(e,t){return p(this,e,t)}}]),e}();function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;d(this,e),this.img=new Image,this.img.src=t,this.w=i,this.h=n,this.x=a,this.y=s,this.visible=!0}var t,i,n;return t=e,(i=[{key:"drawToCanvas",value:function(e){this.visible&&e.drawImage(this.img,this.x,this.y,this.w,this.h)}}])&&v(t.prototype,i),n&&v(t,n),e}(),g=[{w:384,h:204},{w:224,h:260},{w:320,h:184},{w:220,h:152},{w:180,h:128},{w:128,h:232},{w:256,h:156},{w:252,h:164},{w:152,h:140},{w:288,h:160},{w:248,h:124},{w:364,h:252},{w:256,h:156},{w:256,h:184},{w:256,h:188},{w:256,h:128},{w:204,h:128},{w:124,h:184},{w:256,h:132},{w:256,h:192},{w:252,h:248},{w:252,h:248},{w:232,h:256},{w:224,h:140},{w:96,h:128}],x=[{w:48,h:44},{w:116,h:72},{w:128,h:124},{w:128,h:92},{w:128,h:88},{w:64,h:124},{w:256,h:128},{w:60,h:124},{w:64,h:128},{w:192,h:128},{w:64,h:128},{w:64,h:132},{w:64,h:68},{w:40,h:112},{w:64,h:116},{w:64,h:68},{w:64,h:56},{w:96,h:96},{w:96,h:96},{w:64,h:100},{w:56,h:60},{w:60,h:124},{w:96,h:60},{w:72,h:72},{w:52,h:188},{w:64,h:60},{w:64,h:128},{w:64,h:64},{w:64,h:136},{w:124,h:192},{w:64,h:124},{w:92,h:124},{w:160,h:176},{w:128,h:64}];function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var I=function(){function e(t,i,n){b(this,e),this.bodys=[],this.distance=i,this.margin=15*pixelRatio,this.visible=!0;for(var a=main.deadtemp.map((function(e){return e.name})),s=arguments.length,o=new Array(s>3?s-3:0),r=3;r<s;r++)o[r-3]=arguments[r];Object.assign.apply(Object,[this].concat(o));for(var l=0,h=t.length;l<h;l++){var c=t[l];c.npc?(c.l=imageMap["./images/npc/0".concat(c.s,".png")],c.w=32*pixelRatio,c.h=32*pixelRatio,c.talk=c.talk||["对方没什么想和你说的"],c.states=c.states||["没什么可查看的"]):c.build?(c.l=imageMap["./images/building/0".concat(c.s,".png")],c.w=g[c.s-1].w/2*pixelRatio,c.h=g[c.s-1].h/2*pixelRatio):(c.l=imageMap["./images/other/0".concat(c.s,".png")],c.w=x[c.s-1].w/2*pixelRatio,c.h=x[c.s-1].h/2*pixelRatio);var u=new w(c.l,c.w,c.h,this.distance,n-c.h);a.includes(c.name)&&(u.visible=!1),this.bodys.push(Object.assign({},c,u)),this.distance+=c.w+this.margin}}var t,i,n;return t=e,(i=[{key:"drawToCanvas",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.visible){for(var i=0,n=this.bodys.length;i<n;i++)if(this.bodys[i].visible){var a=this.bodys[i],s=a.x+t,o=a.y;e.drawImage(a.img,s,o,a.w,a.h)}for(var r=0,l=this.bodys.length;r<l;r++)if(this.bodys[r].visible){var h=this.bodys[r],c=h.x+t,u=h.y;h.name&&(e.save(),e.fillStyle="#fff",e.fillRect(c,u-20*pixelRatio,12*pixelRatio*h.name.length,12*pixelRatio),e.fillStyle="#000",e.font="".concat(12*pixelRatio,"px sans-serif"),e.fillText(h.name,c,u-20*pixelRatio),e.restore())}if(this.isIndoor){var p=25*pixelRatio;e.beginPath(),e.moveTo(0,MIDDLE_Y-200*pixelRatio),e.lineTo(SCREEN_WIDTH,MIDDLE_Y-200*pixelRatio),e.moveTo(0,MIDDLE_Y+p),e.lineTo(MIDDLE_X-20*pixelRatio,MIDDLE_Y+p),e.moveTo(MIDDLE_X+20*pixelRatio,MIDDLE_Y+p),e.lineTo(SCREEN_WIDTH,MIDDLE_Y+p),e.moveTo(MIDDLE_X-20*pixelRatio,MIDDLE_Y+8*pixelRatio+p),e.lineTo(MIDDLE_X-20*pixelRatio,MIDDLE_Y+p),e.moveTo(MIDDLE_X+20*pixelRatio,MIDDLE_Y+8*pixelRatio+p),e.lineTo(MIDDLE_X+20*pixelRatio,MIDDLE_Y+p),e.stroke()}}}}])&&y(t.prototype,i),n&&y(t,n),e}();function D(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function R(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?D(Object(i),!0).forEach((function(t){S(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function S(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var k=["华山","泰山","衡山","嵩山","青城山","日月教"],M={"平安镇":[{s:19,name:"平安镇"},{s:21},{s:29},{s:29},{s:36,npc:!0,name:"老乞丐",talk:["有有无无且耐烦，劳劳碌碌几时间，人心曲曲弯弯水，世事重重叠叠山"],states:["游走武林，以行乞维生，个性闲散好游，颇有正义感"],lv:70},{s:7,npc:!0,name:"圆儿",talk:["四处走~四处走~"],states:["长得像个小猴子，天资聪颖伶俐、悟性高、极富同情心"],lv:50},{s:37,npc:!0,name:"石天王",talk:["你看起来很好吃"],states:["圆儿于山神庙中结识的石头公，外表穷凶恶煞，但性格平易近人、温和善良"],lv:40},{s:14,build:!0,indoor:[{s:3},{s:1},{s:8,npc:!0,name:"店小二",talk:["客官要点什么？"],states:["这家酒馆的店小二"],lv:1,sale:["水酒","馒头"]}]},{s:29},{s:29},{s:20,build:!0,indoor:[{s:4},{s:23,npc:!0,name:"江湖郎中",talk:["行走江湖，还是要备些药膏在身"],states:["一个卖药的人，颇有些功夫在身"],lv:30,sale:["黑玉断续膏","天香断续膏"]}]},{s:29},{s:29}],"华山":[],"泰山":[],"衡山":[],"嵩山":[],"青城山":[],"日月教":[]},T={"华山":[{name:"岳肃",lv:140,s:20},{name:"蔡子峰",lv:140,s:21},{name:"岳不群",lv:100,s:40},{name:"封不平",lv:80,s:11},{name:"成不忧",lv:75,s:12},{name:"丛不弃",lv:75,s:5},{name:"劳德诺",lv:60,s:24},{name:"梁发",lv:40,s:8},{name:"施戴子",lv:40,s:13},{name:"高根明",lv:40,s:44},{name:"陆大有",lv:35,s:6},{name:"陶钧",lv:35,s:35},{name:"英白罗",lv:35,s:17},{name:"岳灵珊",lv:35,s:53}],"泰山":[{name:"东灵道长",lv:160,s:20},{name:"天门道人",lv:80,s:33},{name:"天松道人",lv:80,s:34},{name:"天乙道人",lv:80,s:9},{name:"玉矶子",lv:90,s:22},{name:"玉磬子",lv:90,s:44},{name:"玉音子",lv:90,s:38},{name:"玉钟子",lv:90,s:39},{name:"迟百城",lv:30,s:35},{name:"建除",lv:30,s:10}],"衡山":[{name:"莫大",lv:110,s:36},{name:"刘正风",lv:90,s:1},{name:"鲁正荣",lv:80,s:23},{name:"向大年",lv:40,s:10},{name:"米为义",lv:40,s:12},{name:"方千驹",lv:35,s:13},{name:"刘菁",lv:15,s:62},{name:"刘芹",lv:5,s:45}],"嵩山":[{name:"左冷禅",lv:120,s:17},{name:"丁勉",lv:100,s:32},{name:"陆柏",lv:95,s:29},{name:"费彬",lv:95,s:28},{name:"乐厚",lv:95,s:24},{name:"钟镇",lv:95,s:34},{name:"汤英鹗",lv:95,s:38},{name:"卜沉",lv:75,s:33},{name:"沙天江",lv:75,s:31},{name:"史登达",lv:60,s:8},{name:"狄修",lv:55,s:16}],"青城山":[{name:"长青子",lv:140,s:20},{name:"余沧海",lv:95,s:8},{name:"侯人英",lv:60,s:22},{name:"洪人雄",lv:60,s:44},{name:"余人豪",lv:55,s:32},{name:"罗人杰",lv:55,s:31},{name:"贾人达",lv:40,s:23},{name:"方人智",lv:40,s:24},{name:"吉人通",lv:35,s:11},{name:"申人俊",lv:35,s:16},{name:"黎人洪",lv:35,s:14}],"日月教":[{name:"任我行",lv:135,s:33},{name:"向问天",lv:120,s:34},{name:"杨莲亭",lv:60,s:5},{name:"范松",lv:115,s:17},{name:"赵鹤",lv:115,s:37},{name:"张乘风",lv:115,s:1},{name:"张乘云",lv:115,s:9},{name:"曲阳",lv:100,s:36},{name:"贾布",lv:90,s:39},{name:"上官云",lv:90,s:42},{name:"童百熊",lv:90,s:43},{name:"罗长老",lv:90,s:38},{name:"曲非烟",lv:15,s:51}]};function E(e){return e[Math.floor(Math.random()*e.length)]}function _(e){var t={decorateArr:[14,15,22,23,26,27,28,29,30,31,32,33],buildArr:[1,2,3,4,5,6,7,8,9,10,11,12,14,15,16,17],furnitureArr:[1,2,3,4,5,6,8,11,12,22,24,31]},i={npcSet:[],furnitureSet:[],decorateSet:[],buildSet:[]};function n(){var t=E(T[e]);return i.npcSet.includes(t.name)?n():(i.npcSet.push(t.name),R(R({},t),{},{npc:!0}))}function a(e){var n=E(t[e+"Arr"]);return i[e+"Set"].includes(n)?a(e):(i[e+"Set"].push(n),n)}function s(){var e=a("decorate");r.push({s:e}),r.push({s:e})}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=a("build"),o=[n(),n()],l=[{s:a("furniture")},{s:a("furniture")}];if(1===t&&l.pop(),1===e){var h=o.pop();i.npcSet=i.npcSet.filter((function(e){return e!==h.name}))}r.push({s:s,build:!0,indoor:[].concat(o,l)})}var r=[];return r.push({s:19,name:e}),s(),o(2,1),s(),o(1,2),s(),o(1,2),s(),o(1,2),s(),o(1,2),s(),o(2,1),s(),r}function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var C=[{attackWords:["N一招「背心钉」，转到SB的身后，一掌猛向SB背心灵台穴拍去。","N一招「游空探爪」，飞起身形自半空中变掌为抓锁向SB。","N大喝一声，身形下伏，一招「劈雷坠地」，捶向SB双腿。","N运气于掌，一瞬间掌心变得血红，一式「掌心雷」，推向SB。","N阴手翻起阳手跟进，一招「没遮拦」，结结实实的捶向SB。","N上步抢身，招中套招，一招「劈挂连环」，连环攻向SB。","N走天阵，跨乾位，使一招「天道无常」，抖臂发劲一掌攻向SB。","N转地阵，居坤位，一招「地震三岗」，直取SB。","N上风阵，取巽位，一招「风起云涌」，掌势变幻击向SB。","N过云阵，居震位，一式「云海茫茫」，双掌交错击向SB。","N脚下方位变幻，一招「飞龙居坎」，左掌斜引右掌穿出，拍向SB。","N脚踏八卦方位，一招「鸟翔归离」，却步抽身双掌一前一后相继击向SB。","N身法越转越快，一瞬间踏遍天地风云四门，「四正四奇」，连攻八掌。","N默念口诀，由归寐转无妄，自同人趋大有，一招「四开四阖」，连出十六掌。"],defenceWords:["SB暗运真气，一招「龙飞凤舞」，远远避了开去。","SB一招「游龙戏凤」，身形晃动早闪在一旁。","SB一式「龙翔在天」，急跃而起，在空中一个转折落在丈外。","SB脚步错落，暗踩梅花桩，一招「龙游掠波」，闪了开去。","SB身形连晃使一招「云龙三现」，连续三个空心斛斗跳了开去。"]},{attackWords:["N双臂直上直下连续三击，正合「击鼓三通」之拳理。","N一招「帝斩白蛇」，右拳变掌向SB横扫过去。","N一招「冲锋陷阵」，两拳虎口相对，猛力撞向SB。","N坐马沉腰，沉肩发力，一招「暮鼓晨钟」，拳劲大得异乎寻常。","N使一招「黄袍加身」，双拳一立垫步拧腰打向SB。","N左拳虚晃，右拳一招「黑虎偷心」直掏SB胸口。"],defenceWords:["SB展动身法，一招「鹤舞白沙」，闪了开去。","SB一招「鹤舞九天」，冲天而起，跃出丈外。","SB使一招「梅妻鹤子」，脚下倒踩梅花桩一下绕到N身后。","SB斜身一让，一招「乳鹤归巢」，斜飞数丈，脚一点地又飘了回去。","SB一招「鹤影参云」，斜飞而起，半空中一个倒卷帘轻轻落下。","SB一招「鹤隐南山」，急向后退，直退出丈外，忽又如大鸟般疾扑而回。"]},{attackWords:["N一招「无法无天」，左手虚晃右拳直击SB前胸。","N右拳一立，左拳一招「无法无章」，竟不按常理反向挥出。","N一招「无依无据」，双拳连环击向SB。","N哈哈大笑，笑声中一招「无法无规」，双拳分击SB右脑与右臀，实是怪异。","N一招「无章可寻」，左拳后发先至右拳先发后至，齐向SB袭来。"],defenceWords:["SB一招「无影无踪」，倏地闪在一旁。","SB身开急转，一招「暗无天日」，绕到N背后。","SB一招「移形换位」，不见迈步却避到七尺之外。","SB高蹿低伏，一招半隐半现，一下子不见了身影。","SB一跺脚，一招「天魔出世」，一阵烟幕后随即不知去向。","SB一招「无声无息」，一扭身与周围景色融成一体，N竟不知如何是好。"]},{attackWords:["N招式阴阳变化，忽地右手翻出，左拳沉腰，发出太极刚劲，一式“搬拦锤”，直向SB锤去。","N接着一招「揽雀尾」，双手划了个半圆，左阴右阳，按向SB的前胸。","N单脚独立，左手虚按，右手使一招「白鹤亮翅」，变拳为抓，向SB插去。","N右臂半环，左臂内旋，一招「手挥琵琶」，十指虚张，缓缓挥向SB的左臂。","N右腿伸直，左手虚划，接着右手外旋搬出，一记「进步搬拦捶」，击向SB的左脚。","N右脚虚立，左手画圆后抚，一招「高探马」，右手圆转向，前朝SB的面门挥去。","N左脚踏前半步，右手虚张使一招「海底针」，五指由下向上戳向SB的裆部。","N使出一招「云手」，左手高，右手低，一个圆圈已将SB的全身套住，太极柔劲随即发出。","N脚踏七星方位，左虚右实，双拳交叉成十字，一招「进步七星」，向SB推去。","N施出「转身搬拦捶」，上体右转，右拳由下向上经左臂内侧搬向SB的前胸。","N左右手臂外旋变掌，两手交叉，继而左右分开，成半招「如封似闭」，推向SB的前胸。","N上体微右转，屈膝坐胯，出招「十字手」，两臂微内旋，分别向SB的两侧划弧发掌。"],defenceWords:["只见SB一招「白鹤冲天」，身体向上笔直地纵起丈余，躲过了N这一招。","SB使一招「鹞子翻身」，上半身急向后仰，于间不容发之际闪了开去。","SB一招「大鹏展翅」，一个抢步跨出数尺，避开N这一招。","SB使出「溪流归海」，向一旁飘然一纵，轻轻着地。","SB一个「叶落归根」，向后纵跃出数丈之远，避开了N的凌厉攻势。"]},{attackWords:["N一招「长者折梅」，双掌簸张，夹着一阵寒气直取SB。","N一招「拨云见日」，左掌划个圈子，右手变掌成抓，倏地从圈中击出。","N使一招「漫天飞雪」，双掌上下飞舞，夹杂着冰雪之势直取SB。","N逆运雪山心法，脸露笑容，一招「冰谷初阳」，从不可思议的角度抓向SB。","N一招「飞雪如虹」，忽地转到SB身后，直取SB背心灵台穴。","N左手成鹰爪右手成鹤啄，忽地右手翻为虎爪左手变为龙形，正是那招「风翻云变」。","N展动身形使出「雪落无声」，高高跃起，轻飘飘地一掌击向SB。","N双掌变得雪白，一招「冰封地彻」攻向SB，一时间SB上盘七处要穴堪忧。"],defenceWords:["SB一招「夕阳残雪」，轻轻巧巧地避了开去。","只见SB身影一晃，一式「开阳薄雾」，早已避在七尺之外。","SB使出「信步闲庭」，轻轻松松地闪过。","SB左足一点，一招「万里雪飘」，腾飞而起，避了开去。","可是SB一招「踏雪无痕」，身子轻轻飘了开去。","SB身影微动，已经藉一招「雪影无踪」，轻轻闪过。"]}],L=["对SB造成了颇为严重的伤害","一击命中，SB痛苦地闷哼了一声","「砰」的一声，SB退了两步","SB连退了好几步，差一点摔倒","SB痛苦地闷哼了一声，显然受了点内伤","SB摇摇晃晃，一跤摔倒在地","SB皮开肉破，鲜血流了下来"],O=function(){function e(t){var i,n,a,s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=function(){if(!s.isFighting){var e=main,t=e.bottomText,i=e.autohideText,n=e.statusStack;s.isFighting=!0,t.visible=!1;var a=E(C),o=a.attackWords,r=a.defenceWords,l=[E(o).replace(/SB/g,s.enemy.name).replace(/N/g,"你"),E(r).replace(/SB/g,s.enemy.name).replace(/N/g,"你"),E(L).replace(/SB/g,s.enemy.name),E(o).replace(/SB/g,"你").replace(/N/g,s.enemy.name),E(r).replace(/SB/g,"你").replace(/N/g,s.enemy.name),E(L).replace(/SB/g,"你")],h=s.self.lv-s.enemy.lv;s.self.hitrate=Math.max(.8,.8+.025*h),s.enemy.hitrate=.75-.025*h,new Promise((function(e){i.setContent([l[0]]),setTimeout((function(){Math.random()<=s.self.hitrate?(i.setContent([l[2]]),s.enemy.hp-=s.self.attack*(s.self.water<50||s.self.food<50?.5:1)*(.5*Math.random()+.75),s.enemy.hp=Math.max(0,s.enemy.hp),s.hitTarget="enemy"):i.setContent([l[1]]),setTimeout(e,1100)}),1100)})).then((function(){if(!(s.enemy.hp<=0))return new Promise((function(e){s.hitTarget="",i.setContent([l[3]]),setTimeout((function(){Math.random()<=s.enemy.hitrate?(i.setContent([l[5]]),s.self.hp-=Math.floor(s.enemy.attack*(.5*Math.random()+.75)),s.self.hp=Math.max(0,s.self.hp),s.hitTarget="self"):i.setContent([l[4]]),setTimeout(e,1100)}),1100)}))})).then((function(){if(s.hitTarget="",s.isFighting=!1,t.visible=!0,s.self.hp<=0||s.enemy.hp<=0)if(main.getLastItem("sceneStack").visible=!0,main.fight.visible=!1,s.self.visible=!0,t.visible=!1,n.pop(),s.self.hp<=0)main.die();else{var e={gold:50*s.enemy.lv,exp:50*s.enemy.lv,items:[]};h>=10&&delete e.exp,(s.enemy.items||[]).forEach((function(t){Math.random()<=t.r&&e.items.push({n:t.n,c:1})})),s.self.getReward(e),n.pop(),s.enemy.visible=!1,main.deadtemp.push({name:s.enemy.name,time:24});var i=main.eventList.find((function(e){return s.enemy.name.includes(e.kill)}));i&&(i.count-=1)}}))}},(n="doFight")in(i=this)?Object.defineProperty(i,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[n]=a,this.self=main.player,this.enemy=t,this.enemy.maxhp=Math.ceil(50*t.lv*(.5*Math.random()+.75)),this.enemy.hp=this.enemy.maxhp,this.enemy.attack=10*t.lv,this.hitTarget="",this.hitImage=new Image,this.hitImage.src=imageMap["./images/other/hit.png"],this.w=32*pixelRatio,this.h=32*pixelRatio,this.visible=!1,this.isFighting=!1}var t,i,n;return t=e,(i=[{key:"drawToCanvas",value:function(e){if(this.visible){e.drawImage("self"===this.hitTarget?this.hitImage:this.self.forward,MIDDLE_X-150*pixelRatio-this.w/2,MIDDLE_Y-140*pixelRatio,this.w,this.h),e.drawImage("enemy"===this.hitTarget?this.hitImage:this.enemy.img,MIDDLE_X+150*pixelRatio-this.w/2,MIDDLE_Y-140*pixelRatio,this.w,this.h),e.fillRect(MIDDLE_X-150*pixelRatio-this.w/2,MIDDLE_Y-90*pixelRatio,100*this.self.hp*pixelRatio/this.self.maxhp,6*pixelRatio),e.fillRect(MIDDLE_X-150*pixelRatio-this.w/2,MIDDLE_Y-80*pixelRatio,100*pixelRatio,2*pixelRatio);var t=100*this.enemy.hp/this.enemy.maxhp*pixelRatio;e.fillRect(MIDDLE_X+150*pixelRatio+this.w/2-t,MIDDLE_Y-90*pixelRatio,t,6*pixelRatio),e.fillRect(MIDDLE_X+50*pixelRatio+this.w/2,MIDDLE_Y-80*pixelRatio,100*pixelRatio,2*pixelRatio)}}}])&&B(t.prototype,i),n&&B(t,n),e}();function N(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.visible=!1}var t,i,n;return t=e,(i=[{key:"startCure",value:function(){var e=this;this.visible=!0,this.cureTimer=setInterval((function(){main.player.hp+=main.player.lv,main.player.hp>=main.player.maxhp&&e.stopCure(),main.player.hp=Math.min(main.player.hp,main.player.maxhp)}),300)}},{key:"stopCure",value:function(){clearInterval(this.cureTimer),this.visible=!1,main.statusStack.pop()}},{key:"drawToCanvas",value:function(e){this.visible&&(e.save(),e.fillStyle="#fff",e.fillRect(MIDDLE_X-110*pixelRatio,MIDDLE_Y-190*pixelRatio,220*pixelRatio,30*pixelRatio),e.restore(),e.strokeRect(MIDDLE_X-100*pixelRatio,MIDDLE_Y-180*pixelRatio,200*pixelRatio,10*pixelRatio),e.fillRect(MIDDLE_X-100*pixelRatio,MIDDLE_Y-180*pixelRatio,main.player.hp/main.player.maxhp*200*pixelRatio,10*pixelRatio))}}])&&N(t.prototype,i),n&&N(t,n),e}(),P=[{n:"水酒",price:20,effect:{water:20}},{n:"馒头",price:20,effect:{food:20}},{n:"黑玉断续膏",price:1e3,effect:{hp:2e3}},{n:"天香断续膏",price:2e3,effect:{hp:4e3}}];function Y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function X(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var H={hp:"血量",water:"水量",food:"食物量"},W=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];A(this,e),this.visible=!1,this.content=[],this.type=t,this.mode=i,this.textIdx=0,this.menuIdx=0,this.autoHide=n,"text"===i&&(this.lines=12,"top"!==t&&"bottom"!==t||(this.lines=6)),this.arrowUp=new Image,this.arrowUp.src=imageMap["./images/other/arrow-up.png"],this.arrowDown=new Image,this.arrowDown.src=imageMap["./images/other/arrow-down.png"],this.arrowRight=new Image,this.arrowRight.src=imageMap["./images/other/arrow-right.png"]}var t,i,a;return t=e,(i=[{key:"setContent",value:function(e){var t=this;this.textIdx=0;var i=Math.floor((SCREEN_WIDTH-8*pixelRatio-20*pixelRatio)/(20*pixelRatio));if("menu"===this.mode)this.content=e,this.lines="item"===this.type?6:Math.min(4,e.length);else{var n=[];e.forEach((function(e){for(var t=0;t*i<=e.length;)n.push(e.slice(t*i,(t+1)*i)),t++})),this.content=n}this.visible=!0,this.autoHide&&setTimeout((function(){t.visible=!1}),1e3)}},{key:"changeIdx",value:function(e){"menu"===this.mode?(-1===e?this.menuIdx=Math.max(0,this.menuIdx-1):1===e&&(this.menuIdx=Math.min(this.content.length-1,this.menuIdx+1)),1===e&&this.menuIdx>=this.textIdx+this.lines?this.textIdx=Math.min(this.content.length-1,this.textIdx+this.lines):-1===e&&this.menuIdx<this.textIdx&&(this.textIdx=Math.max(0,this.textIdx-this.lines))):-1===e?this.textIdx=Math.max(0,this.textIdx-this.lines):1===e&&this.textIdx+this.lines<this.content.length&&(this.textIdx=Math.min(this.content.length-1,this.textIdx+this.lines))}},{key:"drawToCanvas",value:function(e){if(this.visible){var t=20*pixelRatio,i=SCREEN_WIDTH-8*pixelRatio,n=t*this.lines+8*pixelRatio,a=4*pixelRatio,s="bottom"===this.type?MIDDLE_Y-72*pixelRatio:MIDDLE_Y-200*pixelRatio;if("menu"===this.mode)switch(s=MIDDLE_Y-144*pixelRatio,i=74*pixelRatio,n=this.lines*t+8*pixelRatio,this.type){case"map":a=20*pixelRatio,i=114*pixelRatio;break;case"player":a=20*pixelRatio;break;case"npc":a=MIDDLE_X-37*pixelRatio;break;case"item":s=MIDDLE_Y-200*pixelRatio,i=SCREEN_WIDTH-8*pixelRatio;break;case"welcome":a=MIDDLE_X-54*pixelRatio,s=MIDDLE_Y-40*pixelRatio}if(e.save(),e.fillStyle="#fff",e.fillRect(a,s,i,n),e.restore(),this.autoHide||"welcome"===this.type||e.strokeRect(a,s,i,n),"item"===this.type){var o=[0,180,300],r=["物品","价格","已有"];e.fillText("金钱: ".concat(main.player.gold),a+10*pixelRatio,s-60*pixelRatio);for(var l=0;l<3;l++)e.fillText(r[l],a+10*pixelRatio+o[l]*pixelRatio,s-30*pixelRatio);for(var h=0;h<this.lines&&this.textIdx+h<this.content.length;h++)for(var c=0;c<3;c++)e.fillText(this.content[this.textIdx+h][c],a+14*pixelRatio+o[c]*pixelRatio,s+t*h+4*pixelRatio);var u=this.content[this.menuIdx],p=P.find((function(e){return e.n===u[0]})),m=main,f=m.bottomText;if(m.isSaleing){var d=["按「确认」购买物品，按「取消」退出"];p.effect&&["hp","food","water"].forEach((function(e){p.effect[e]&&(d=["功效：恢复".concat(p.effect[e]).concat(H[e]),""].concat(d))})),f.setContent(d)}else p.effect?["hp","food","water"].forEach((function(e){p.effect[e]&&f.setContent(["功效：恢复".concat(p.effect[e]).concat(H[e]),"","按「确认」使用物品，按「取消」退出，按「菜单」丢弃物品"])})):f.setContent(["按「菜单」丢弃物品"])}else for(var v=0;v<this.lines&&this.textIdx+v<this.content.length;v++)e.fillText(this.content[this.textIdx+v],"menu"===this.mode?a+14*pixelRatio:a+4*pixelRatio,s+t*v+4*pixelRatio);"menu"===this.mode&&e.drawImage(this.arrowRight,a+2*pixelRatio,s+this.menuIdx%this.lines*t+4*pixelRatio,12.5*pixelRatio,20*pixelRatio),this.textIdx+this.lines<this.content.length&&e.drawImage(this.arrowDown,a+i-20*pixelRatio,s+n-18*pixelRatio,20*pixelRatio,12.5*pixelRatio),this.textIdx>0&&e.drawImage(this.arrowUp,a+i-20*pixelRatio,s+n-36*pixelRatio,20*pixelRatio,12.5*pixelRatio)}}},{key:"responseToMenu",value:function(){var e=this,t=main,i=t.npc,a=t.player,s=t.eventList,o=t.topText,r=t.fullText,l=t.bottomText,h=t.statusStack,c=t.itemMenu,u=t.autohideText,p=t.isSaleing,m=t.cure,f=this.content[this.menuIdx];switch(window.getSaleText=function(e){return e.map((function(e){var t=P.find((function(t){return t.n===e})),i=a.items.find((function(t){return t.n===e}));return[e,t.price,i&&i.c||0]}))},this.type){case"map":main.sceneName=Object.keys(M)[this.menuIdx],main.sceneStack=[new I("平安镇"===main.sceneName?M["平安镇"]:_(main.sceneName),MIDDLE_X-16*pixelRatio,BUILDING_Y)],main.offset_indoor=0,main.offset_outdoor=0,h.pop();break;case"npc":switch(f){case"任务":var d=s.find((function(e){return e.entrust===i.name}));if(d){var v=function(){a.getReward(d.reward),o.setContent(["你完成了任务，这是你的奖励"]),main.eventList=s.filter((function(e){return e!==d}))};if(d.item){var w=a.items.find((function(e){return e.n===d.item}));w&&d.count<=w.c?(w.c-=d.count,v()):o.setContent(i.talk)}else d.kill?d.count<=0?v():o.setContent(i.talk):d.gold?d.gold<=a.gold?(a.gold-=d.gold,v()):o.setContent(i.talk):d.talk&&(d.count<=0?v():o.setContent(i.talk))}else{var g,x=E(k),b=E(T[x]).name;switch(i.name){case"老乞丐":g={talk:b},o.setContent(["我这里有一封密信交给「".concat(x,"」的「").concat(b,"」，你帮我交给ta")]);break;case"圆儿":o.setContent(["我这儿暂时还没有任务可以给你"]);break;case"石天王":g={kill:b},o.setContent(["「".concat(x,"」的「").concat(b,"」最近在江湖中声名鹊起，你去和ta切磋几招")])}g&&main.eventList.push(function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(i),!0).forEach((function(t){X(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({entrust:i.name,count:1,place:x,reward:{gold:50*a.lv,exp:100*a.lv}},g))}h.push("topText");break;case"对话":var y=s.find((function(e){return e.talk===i.name}));y?(y.count-=1,o.setContent(["信我收到了，多谢，你去回复老乞丐吧"])):o.setContent(i.talk),h.push("topText");break;case"查看":r.setContent(i.states.concat(["等级: ".concat(i.lv),"武艺: ".concat(n[Math.min(36,Math.floor(i.lv/5))]),"物品: ".concat(i.items?i.items.map((function(e){return e.n+"("+e.r+")"})).join("，"):"无")])),h.push("fullText");break;case"战斗":a.water<50?u.setContent(["你的水量少于50，无法进行战斗"]):a.food<50?u.setContent(["你的食物量少于50，无法进行战斗"]):(this.menuIdx=0,main.fight=new O(i,main),main.fight.visible=!0,main.getLastItem("sceneStack").visible=!1,a.visible=!1,h.push("fight"),l.setContent(["按「确认」攻击，按「菜单」使用物品"]));break;case"交易":c.setContent(getSaleText(i.sale)),h.push("itemMenu"),main.isSaleing=!0}break;case"player":switch(f){case"状态":r.setContent(a.getStatesText()),main.statesTimer=setInterval((function(){r.setContent(a.getStatesText())}),6e3),h.push("fullText");break;case"任务":var D=[];s.forEach((function(e){e.talk?D=D.concat("".concat(e.entrust,"让你交一封密信给「").concat(e.place,"」的「").concat(e.talk,"」")):e.kill?D=D.concat("".concat(e.entrust,"让你和「").concat(e.place,"」的「").concat(e.kill,"」切磋几招")):e.item&&(D=D.concat("".concat(e.entrust,"让你取回「").concat(e.place).concat(e.owner,"」的「").concat(e.item,"」")))})),D.length<1&&(D=["当前无任务"]),r.setContent(D),h.push("fullText");break;case"物品":a.items.length?(c.setContent(getSaleText(a.items.map((function(e){return e.n})))),h.push("itemMenu")):u.setContent(["身上没有物品"]);break;case"疗伤":m.startCure(),h.push("cure")}break;case"item":var R=a.items.find((function(e){return e.n===f[0]})),S=function(){R.c-=1,R.c<=0&&(a.items=a.items.filter((function(e){return e.n!==f[0]})),a.items.length>0?e.menuIdx=0:(h.pop(),"fight"===main.getLastItem("statusStack")?l.setContent(["按「确认」攻击，按「菜单」使用物品"]):l.visible=!1)),c.setContent(getSaleText(a.items.map((function(e){return e.n}))))};if(p)a.gold>=f[1]?(R?R.c+=1:a.items.push({n:f[0],c:1}),a.gold-=f[1],c.setContent(getSaleText(i.sale))):u.setContent(["你的金钱不够"]);else if(main.isThrowing)R&&S(),main.isThrowing=!1;else{var B=P.find((function(e){return e.n===f[0]}));B.effect&&["hp","food","water"].forEach((function(e){B.effect[e]&&(a[e]<a["max".concat(e)]?(a[e]+=B.effect[e],a[e]=Math.min(a["max".concat(e)],a[e]),R&&S(),u.setContent(["恢复".concat(B.effect[e]).concat(H[e])])):u.setContent(["你的".concat(H[e],"已达上线")]))}))}break;case"welcome":switch(f){case"新游戏":localStorage.setItem("__save_data__","{}"),setSaveData({hasSave:!0});case"继续游戏":welcome.enterGame();break;case"攻略":welcome.scene="specification",welcome.menu.visible=!1,welcome.fullText.setContent(["可以接任务和交易的NPC都在平安镇，其他地点的NPC都是任务NPC，接任务、完成任务、升级","","战斗之前记得查看对方的等级，超过5级的差距，极有可能打不过","","除了平安镇以外，其他地图的地形和人物位置是每次进入都会变化的，并且每次不一定会刷出这个地点上的所有人物"]);break;case"制作感言":welcome.scene="words",welcome.menu.visible=!1,welcome.fullText.setContent(["这个游戏里的各种素材，以及它的玩法等等，来自于我初中时候玩的一个文曲星上的游戏，叫做英雄坛说","","这个游戏陪伴了我很多时光，到我大学和毕业以后，偶然看到PC上文曲星的模拟器以及安卓上这个游戏的移植，还会想着玩一玩","","也正是因为在手机上玩了几天后，萌生了自己写一个的想法，碰巧我扒到了它的素材，就更加坚定了我的想法","","其实素材对于我是最困难的一步，因为我不会画画，不会设计，我这种行为应该也算在侵权的范畴，希望各位玩家和游戏的设计组能够原谅","","开始觉得这个游戏的机制比较简单，应该会比较容易写，不过麻雀虽小五脏俱全，在开发过程中还是经历过很多的思考和尝试","","比如原本的任务系统比现在的复杂很多，有任务链、有主线和支线剧情，不过因为我实在编不出好的剧情而砍掉了","","只留下现在这个和原作几乎一样的极其简陋的任务系统","","在开发过程中，机缘巧合还去尝试过RPG Maker，感觉还不错，功能齐全","","不过没花太多时间研究，因为默认内置的素材风格跟我想要的区别挺大的，其实就是懒，所以宁可自己写","","2020年对我的职业生涯来说是个低谷，不过在这个低谷中也有很多很多让我感到开心的事","","比如我开始写自己的组件库，写这个游戏等等，这些事情都带给了我巨大的快乐，很多次到了凌晨两点多还不想睡，爬上床有了个新想法又穿衣服起来继续敲代码","","我想这一年发生的种种，也让我重新开始思考自己想要的是什么，到底哪些事情是值得我花时间的，以及我想要成为什么样的人","","也感谢我的家人，这一年我没少跟ta们发牢骚，也正是在这些意义不明的吐槽和耐心的安慰中，我比以往更多地感受到了家人的温暖","","如果有什么建议，欢迎发邮件给我，vzhufeng@163.com，如果要喷请温柔一些，谢谢","","enjoy"])}}}}])&&F(t.prototype,i),a&&F(t,a),e}();function G(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var q=canvas.getContext("2d"),J=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),U(this,"loop",(function(){q.clearRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT),q.fillStyle="#fff",q.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT),q.fillStyle="#000",t.dbleftBtn.drawToCanvas(q),t.dbrightBtn.drawToCanvas(q),t.leftBtn.drawToCanvas(q),t.rightBtn.drawToCanvas(q),t.topBtn.drawToCanvas(q),t.bottomBtn.drawToCanvas(q),t.okBtn.drawToCanvas(q),t.cancelBtn.drawToCanvas(q),t.menuBtn.drawToCanvas(q),t.mapBtn.drawToCanvas(q),t.player.drawToCanvas(q),t.getLastItem("sceneStack").drawToCanvas(q,t.getLastOffset()),t.adjustVisible(),t.npcMenu.drawToCanvas(q),t.playerMenu.drawToCanvas(q),t.itemMenu.drawToCanvas(q),t.mapMenu.drawToCanvas(q),t.cure.drawToCanvas(q),t.topText.drawToCanvas(q),t.bottomText.drawToCanvas(q),t.fullText.drawToCanvas(q),t.fight.drawToCanvas(q),t.autohideText.drawToCanvas(q),t.renderTimer=window.requestAnimationFrame(t.loop)})),U(this,"touchEvent",(function(){var e=16*pixelRatio;window.addEventListener(isMobile?"touchstart":"mousedown",(function(i){var n=(i.clientX||i.touches[0].clientX)*pixelRatio,a=(i.clientY||i.touches[0].clientY)*pixelRatio,s=t.getLastItem("statusStack"),o=function(i){t.player.turn(i);var n=t["offset_".concat(s)];"left"===i&&(n+=e),"right"===i&&(n-=e),n>0&&(n=0);var a=t.getLastItem("sceneStack").distance;n<MIDDLE_X-a&&(n=MIDDLE_X-a),t["offset_".concat(s)]=n},r=function(e){t.lastTouch=e,["indoor","outdoor"].includes(s)&&(t.runTimer?(clearInterval(t.runTimer),t.runTimer=null):t.runTimer=setInterval((function(){o(e)}),100))},l=function(e){switch(s){case"topText":case"fullText":"forward"===e&&t[s].changeIdx(1),"back"===e&&t[s].changeIdx(-1);break;case"npcMenu":case"playerMenu":case"itemMenu":case"mapMenu":"forward"===e&&t[s].changeIdx(1),"back"===e&&t[s].changeIdx(-1);break;case"indoor":case"outdoor":t.lastTouch=e,t.player.turn(e),["left","right"].includes(e)&&o(e)}};if(t.dbleftBtn.checkIsFingerOn(n,a)?r("left"):t.dbrightBtn.checkIsFingerOn(n,a)?r("right"):(clearInterval(t.runTimer),t.runTimer=null),t.leftBtn.checkIsFingerOn(n,a))l("left");else if(t.rightBtn.checkIsFingerOn(n,a))l("right");else if(t.topBtn.checkIsFingerOn(n,a))"back"===t.lastTouch&&["outdoor","indoor"].includes(s)&&t.checkCollide(s),l("back");else if(t.bottomBtn.checkIsFingerOn(n,a))"forward"===t.lastTouch&&"indoor"===s&&t.goOutDoor(),l("forward");else if(t.okBtn.checkIsFingerOn(n,a))switch(s){case"indoor":"forward"===t.lastTouch&&t.goOutDoor();case"outdoor":"back"===t.lastTouch&&t.checkCollide(s);break;case"npcMenu":case"playerMenu":case"itemMenu":case"mapMenu":t[s].responseToMenu();break;case"topText":case"fullText":t.statusStack.pop();break;case"fight":t.fight.doFight()}else if(t.cancelBtn.checkIsFingerOn(n,a))switch(s){case"npcMenu":case"playerMenu":case"itemMenu":case"mapMenu":t[s].menuIdx=0,t[s].textIdx=0,t.statusStack.pop(),"fight"===t.getLastItem("statusStack")?t.bottomText.setContent(["按「确认」攻击，按「菜单」使用物品"]):t.bottomText.visible=!1,t.isSaleing=!1;break;case"topText":t.statusStack.pop();break;case"fullText":clearInterval(t.statesTimer),t.statusStack.pop()}else if(t.menuBtn.checkIsFingerOn(n,a))switch(s){case"indoor":case"outdoor":t.statusStack.push("playerMenu");break;case"itemMenu":t.isThrowing=!0,t.itemMenu.responseToMenu();break;case"fight":t.player.items.length?(t.itemMenu.setContent(getSaleText(t.player.items.map((function(e){return e.n})))),t.statusStack.push("itemMenu")):t.autohideText.setContent(["身上没有物品"])}else t.mapBtn.checkIsFingerOn(n,a)&&("outdoor"===s?t.statusStack.push("mapMenu"):"indoor"===s&&t.autohideText.setContent(["室外才能使用地图"]))}))})),window.main=this,this.renderTimer=0,this.offset_outdoor=0,this.offset_indoor=0,this.sceneName="",this.statusStack=["outdoor"],this.sceneStack=[],this.lastTouch="",this.runTimer=0,this.statesTimer=0,this.deadtemp=[],this.isSaleing=!1,this.isThrowing=!1,this.eventList=[],this.fight=new O({l:""},this),this.start()}var t,i,n;return t=e,(i=[{key:"start",value:function(){var e=this;this.dbleftBtn=new m("db-left",MIDDLE_X-100*pixelRatio,MIDDLE_Y+150*pixelRatio),this.dbrightBtn=new m("db-right",MIDDLE_X+100*pixelRatio,MIDDLE_Y+150*pixelRatio),this.leftBtn=new m("key-left",MIDDLE_X-50*pixelRatio,MIDDLE_Y+150*pixelRatio),this.rightBtn=new m("key-right",MIDDLE_X+50*pixelRatio,MIDDLE_Y+150*pixelRatio),this.topBtn=new m("key-up",MIDDLE_X,MIDDLE_Y+100*pixelRatio),this.bottomBtn=new m("key-down",MIDDLE_X,MIDDLE_Y+200*pixelRatio),this.okBtn=new f("确认",MIDDLE_X+90*pixelRatio,MIDDLE_Y+100*pixelRatio),this.cancelBtn=new f("取消",MIDDLE_X+90*pixelRatio,MIDDLE_Y+200*pixelRatio),this.menuBtn=new f("菜单",MIDDLE_X-90*pixelRatio,MIDDLE_Y+100*pixelRatio),this.mapBtn=new f("地图",MIDDLE_X-90*pixelRatio,MIDDLE_Y+200*pixelRatio),this.sceneName="平安镇",this.sceneStack.push(new I(M["平安镇"],MIDDLE_X-16*pixelRatio,BUILDING_Y)),this.player=new l(MIDDLE_X,MIDDLE_Y),this.topText=new W("top","text"),this.bottomText=new W("bottom","text"),this.fullText=new W("full","text"),this.npcMenu=new W("npc","menu"),this.playerMenu=new W("player","menu"),this.playerMenu.setContent(["状态","任务","物品","疗伤"]),this.itemMenu=new W("item","menu"),this.mapMenu=new W("map","menu"),this.mapMenu.setContent(Object.keys(M)),this.cure=new j,this.autohideText=new W("bottom","text",!0),this.touchEvent(),setInterval((function(){e.player.foodwater();var t=e.getLastItem("sceneStack").bodys;e.deadtemp.forEach((function(e){if(e.time-=12,e.time<=0){e.time=void 0;var i=t.find((function(t){return t.name===e.name}));i&&(i.visible=!0)}})),e.deadtemp=e.deadtemp.filter((function(e){return"number"==typeof e.time}))}),12e3),window.cancelAnimationFrame(this.renderTimer),this.renderTimer=window.requestAnimationFrame(this.loop)}},{key:"checkCollide",value:function(e){for(var t=this.getLastItem("sceneStack"),i=t.bodys,n=t.margin,a=0,s=0,o=i.length;s<o;s++){var r=i[s],l=MIDDLE_X-16*pixelRatio+this["offset_".concat(e)]+a;if(MIDDLE_X>=l&&MIDDLE_X<=l+r.w&&r.visible){if(void 0!==r.indoor)this.sceneStack.push(new I(r.indoor,MIDDLE_X-16*pixelRatio,BUILDING_Y,{isIndoor:!0})),this.statusStack.push("indoor");else if(r.npc){this.npc=r;var h=["对话","查看","战斗"];["老乞丐","圆儿","石天王"].includes(r.name)?h=["任务","对话","查看"]:["店小二","江湖郎中"].includes(r.name)&&(h=["交易","对话","查看"]),this.npcMenu.setContent(h),this.statusStack.push("npcMenu")}else r.tips&&(this.topText.setContent(r.tips),this.statusStack.push("topText"));break}a+=r.w+n}}},{key:"die",value:function(){this.offset_outdoor=0,this.offset_indoor=0,this.player.die(),this.fullText.setContent(["你眼前一黑，什么都不知道了..."]),this.statusStack=["outdoor","fullText"],this.sceneStack=[],this.sceneStack.push(new I(M["平安镇"],MIDDLE_X-16*pixelRatio,BUILDING_Y))}},{key:"goOutDoor",value:function(){this.offset_indoor=0,this.sceneStack.pop(),this.statusStack.pop()}},{key:"getLastOffset",value:function(){var e=this.statusStack.lastIndexOf("indoor");return this.statusStack.lastIndexOf("outdoor")>e?this.offset_outdoor:this.offset_indoor}},{key:"getLastItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this[e][this[e].length-t]}},{key:"adjustVisible",value:function(){var e=this,t=this.getLastItem("statusStack");["topText","fullText","npcMenu","playerMenu","mapMenu","itemMenu","fight"].forEach((function(i){e[i].visible=i===t}))}}])&&G(t.prototype,i),n&&G(t,n),e}();function Q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function V(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var z=window.devicePixelRatio;canvas.width=canvas.width*z,canvas.height=canvas.height*z,window.SCREEN_WIDTH=canvas.width,window.SCREEN_HEIGHT=canvas.height,window.MIDDLE_X=canvas.width/2,window.MIDDLE_Y=canvas.height/2,window.BUILDING_Y=canvas.height/2-20*pixelRatio,window.getSaveData=function(){return JSON.parse(localStorage.getItem("__save_data__")||"{}")},window.setSaveData=function(e){localStorage.setItem("__save_data__",JSON.stringify(e))};var K=canvas.getContext("2d"),Z=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),V(this,"touchEvent",(function(e){var i=(e.clientX||e.touches[0].clientX)*pixelRatio,n=(e.clientY||e.touches[0].clientY)*pixelRatio;t.topBtn.checkIsFingerOn(i,n)?"welcome"===t.scene?t.menu.changeIdx(-1):t.fullText.changeIdx(-1):t.bottomBtn.checkIsFingerOn(i,n)?"welcome"===t.scene?t.menu.changeIdx(1):t.fullText.changeIdx(1):t.okBtn.checkIsFingerOn(i,n)?"welcome"===t.scene?t.menu.responseToMenu():(t.scene="welcome",t.fullText.visible=!1,t.menu.visible=!0):t.cancelBtn.checkIsFingerOn(i,n)&&("words"!==t.scene&&"specification"!==t.scene||(t.scene="welcome",t.fullText.visible=!1,t.menu.visible=!0))})),V(this,"loop",(function(){K.clearRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT),K.fillStyle="#fff",K.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT),K.fillStyle="#000",K.save(),K.font="bolder ".concat(80*pixelRatio,"px sans-serif"),K.strokeText("平安镇",MIDDLE_X-120*pixelRatio,MIDDLE_Y-200*pixelRatio),K.font="bolder ".concat(16*pixelRatio,"px sans-serif"),K.fillText("向文曲星游戏《英雄坛说》致敬",MIDDLE_X-110*pixelRatio,MIDDLE_Y-100*pixelRatio),K.restore(),t.leftBtn.drawToCanvas(K),t.rightBtn.drawToCanvas(K),t.topBtn.drawToCanvas(K),t.bottomBtn.drawToCanvas(K),t.okBtn.drawToCanvas(K),t.cancelBtn.drawToCanvas(K),t.menu.drawToCanvas(K),t.fullText.drawToCanvas(K),t.renderTimer=window.requestAnimationFrame(t.loop)})),window.welcome=this,window.main={},this.scene="welcome",this.renderTimer=0,this.start()}var t,i,n;return t=e,(i=[{key:"start",value:function(){K.textBaseline="top",K.strokeStyle="#000",K.font="".concat(20*pixelRatio,"px sans-serif"),K.lineWidth=1*pixelRatio,this.menu=new W("welcome","menu");var e=["继续游戏","新游戏","攻略","制作感言"];getSaveData().hasSave||e.shift(),this.menu.setContent(e),this.menu.visible=!0,this.fullText=new W("full","text"),this.leftBtn=new m("key-left",MIDDLE_X-50*pixelRatio,MIDDLE_Y+150*pixelRatio),this.rightBtn=new m("key-right",MIDDLE_X+50*pixelRatio,MIDDLE_Y+150*pixelRatio),this.topBtn=new m("key-up",MIDDLE_X,MIDDLE_Y+100*pixelRatio),this.bottomBtn=new m("key-down",MIDDLE_X,MIDDLE_Y+200*pixelRatio),this.okBtn=new f("确认",MIDDLE_X+90*pixelRatio,MIDDLE_Y+100*pixelRatio),this.cancelBtn=new f("取消",MIDDLE_X+90*pixelRatio,MIDDLE_Y+200*pixelRatio),window.addEventListener(isMobile?"touchstart":"mousedown",this.touchEvent),window.cancelAnimationFrame(this.renderTimer),this.renderTimer=window.requestAnimationFrame(this.loop)}},{key:"enterGame",value:function(){window.cancelAnimationFrame(this.renderTimer),window.removeEventListener(isMobile?"touchstart":"mousedown",this.touchEvent),new J}}])&&Q(t.prototype,i),n&&Q(t,n),e}();function $(){var e=Object.keys(imageMap).length;e>=138?(document.querySelector("#progress").style.display="none",new Z):document.querySelector("#progress").innerHTML="加载进度：".concat(Math.floor(e/138*100),"%")}window.imageMap={},function(){for(var e=[],t=1;t<26;t++)e.push("./images/building/0".concat(t,".png"));for(var i=1;i<64;i++)e.push("./images/npc/0".concat(i,".png"));for(var n=1;n<35;n++)e.push("./images/other/0".concat(n,".png"));e.push("./images/other/arrow-down.png"),e.push("./images/other/arrow-right.png"),e.push("./images/other/arrow-up.png"),e.push("./images/other/db-left.png"),e.push("./images/other/db-right.png"),e.push("./images/other/hit.png"),e.push("./images/other/key-down.png"),e.push("./images/other/key-left.png"),e.push("./images/other/key-right.png"),e.push("./images/other/key-up.png"),e.push("./images/player/back.png"),e.push("./images/player/forward.png"),e.push("./images/player/left.png"),e.push("./images/player/left2.png"),e.push("./images/player/right.png"),e.push("./images/player/right2.png"),__dev__?(e.forEach((function(e){imageMap[e]=e})),$()):e.forEach((function(e){var t=new Image;t.crossOrigin="Anonymous",t.onload=function(){var i=document.createElement("canvas"),n=i.getContext("2d");i.height=t.naturalHeight,i.width=t.naturalWidth,n.drawImage(t,0,0);var a=i.toDataURL("image/png");imageMap[e]=a,$()},t.src=e,(t.complete||void 0===t.complete)&&(t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.src=e)}))}()}]);